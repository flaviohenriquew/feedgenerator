<!DOCTYPE html>
<html>
  <head>
    <title>Feed RSS com Filtro</title>
    <!-- Adiciona o CSS do Bootstrap -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">Feed RSS com Filtro</h1>
      <form action="./rss" method="get">
        <div class="form-group">
          <label for="url">URL do feed RSS:</label>
          <input
            type="url"
            class="form-control"
            id="url"
            name="url"
            required
            value="https://bj-share.info/feed.php?u:184515;f;c:1;l;h:3f9d0d45"
          />
        </div>
        <div class="form-group">
          <label for="keyword">Palavra-chave para filtragem:</label>
          <input
            type="text"
            class="form-control"
            id="keyword"
            name="keyword"
            required
            value="Dual"
          />
        </div>
        <button type="submit" class="btn btn-primary">Filtrar</button>
      </form>
      <a
        href="./rss?url=https://bj-share.info/feed.php?u:184515;f;c:1;l;h:3f9d0d45&keyword=Dual"
        class="btn btn-info mt-3"
        >Acessar RSS filtrado</a
      >
    </div>

    <!-- Nova seção: TTS (Text-to-Speech) -->
    <div class="container mt-5">
      <h2 class="mb-4">Gerador de Áudio TTS</h2>
      <div class="form-group">
        <label for="voiceSelect">Selecione a Voz</label>
        <select class="form-control" id="voiceSelect">
          <option value="pt-BR-FranciscaNeural">Francisca</option>
          <option value="pt-BR-AntonioNeural">Antonio</option>
        </select>
      </div>
      <div class="form-group">
        <label for="text">Digite o Texto</label>
        <textarea
          class="form-control"
          id="text"
          rows="3"
          placeholder="Digite o texto para gerar áudio"
        ></textarea>
      </div>
      <button class="btn btn-primary" id="generateButton">Gerar Áudio</button>
    </div>

    <!-- Nova seção: Organizador de Playlist M3U -->
    <div class="container mt-5">
      <h2 class="mb-4">Organizar Playlist M3U</h2>
      <div class="form-group">
        <label for="playlistUrl">URL da Playlist M3U</label>
        <input
          type="text"
          class="form-control"
          id="playlistUrl"
          placeholder="Insira a URL da playlist M3U"
        />
      </div>
      <button class="btn btn-success" id="sortPlaylistButton">
        Ordenar e Baixar
      </button>
    </div>

    <!-- JavaScript do Bootstrap e funcionalidades adicionais -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
      // Fetch para exibir o cabeçalho Referer do RSS
      fetch(
        "https://feedgenerator.tech/rss?url=https://bj-share.info/feed.php?u:184515;f;c:1;l;h:3f9d0d45&keyword=Dual"
      )
        .then((response) => {
          const referer = response.headers.get("X-Referer");
          console.log("Referer:", referer);
          return response.text();
        })
        .catch((error) => console.error("Ocorreu um erro:", error));

      // Função para gerar áudio TTS
      $(document).ready(function () {
        $('#generateButton').click(function() {
          const text = $('#text').val();
          const voice = $('#voiceSelect').val();
      
          if (!text || !voice) {
            alert('Por favor, selecione a voz e insira o texto.');
            return;
          }
      
          $.ajax({
            url: '/generate-audio',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ text, voice }),
            xhrFields: { responseType: 'blob' },
            success: function(blob) {
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'output.mp3';
              document.body.appendChild(a);
              a.click();
              a.remove();
              window.URL.revokeObjectURL(url);
            },
            error: function() {
              alert('Erro ao gerar o áudio.');
            }
          });
        });
      });

        // Função para ordenar a playlist M3U
        $("#sortPlaylistButton").click(function () {
          const playlistUrl = $("#playlistUrl").val();
          if (!playlistUrl) {
            alert("Por favor, insira a URL da playlist.");
            return;
          }

          window.location.href = `/ordenar?url=${encodeURIComponent(
            playlistUrl
          )}`;
        });
      });
    </script>
  </body>
</html>
